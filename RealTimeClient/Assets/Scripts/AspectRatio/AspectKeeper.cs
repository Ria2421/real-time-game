//---------------------------------------------------------------
//
// éƒ¢ï½§ï½ï½¢éƒ¢ï½§ï½ï½¹éƒ¢æ™ï½£ï½¹ç¸ºé†ï½¹æ™æ²ºï½ï½¯è±ˆè²»ï½½ï½¿è­„æäºœ [ AspectKeeper.cs ]
// Author:Kenta Nakamoto
// Data:2024/07/17
// Update:2024/07/17
//
//---------------------------------------------------------------
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

[ExecuteAlways] // é™·€èœ¥ï½²èœƒï½½éš´å¼±ï½†ï½ï½»ï½ï½¥é™æ»“ã˜ç¸²å ¤ï½¹ï½§ç¹§‡èåŠ’é—–ï½´è«›å²©˜†éƒ¢ï½§‹
public class AspectKeeper : MonoBehaviour
{
    //-------------------------------------------
    // éƒ¢æ™ï½¼æ–â‰¦éƒ¢æ™¢ï½½ï½¼éƒ¢æ™¢ï½½ï½«éƒ¢æ„

    /// <summary>
    /// é™‡ïï½½ï½¾é«®è¶£ï½½ï½¡é‚µï½ºï½ï½¨é‚µï½ºèœ·ï½¶ï½ç‹—ï½¹ï½§ï½ï½«éƒ¢æ™¢ï½½ï½¡éƒ¢æ™¢ï½½ï½©
    /// </summary>
    [SerializeField]
    private Camera targetCamera;

    /// <summary>
    /// é¨¾ï½¶ï½ï½®é¨¾ï½§„èï½ï½§ï½ï½£é™·å‰ƒï½¸æ©¸ï½½ï½ºï½ï½¦
    /// </summary>
    [SerializeField]
    private Vector2 aspectVec;

    //--------------------------------------------
    // éƒ¢æ™¢ï½½ï½¡éƒ¢ï½§ï½ï½½éƒ¢æ€è½Î›

    /// <summary>
    /// éš´å„ï½½ï½´éš´ïï½½ï½°é™·ƒïï½½ï½¦é¨¾…†
    /// </summary>
    void Update()
    {
        var screenAspect = Screen.width / (float)Screen.height; // é¨¾åŒ…ï½½ï½»é¬®ï½±ï½ï½¢é‚µï½ºï½ï½®éƒ¢ï½§ï½ï½¢éƒ¢ï½§ï½ï½¹éƒ¢æ™ï½£ï½¹ç¸ºé†ï½¹æ™æ²ºï½ï½¯”
        var targetAspect = aspectVec.x / aspectVec.y; // é¨¾ï½¶ï½ï½®é¨¾ï½§„ã®éƒ¢ï½§ï½ï½¢éƒ¢ï½§ï½ï½¹éƒ¢æ™ï½£ï½¹ç¸ºé†ï½¹æ™æ²ºï½ï½¯”

        var magRate = targetAspect / screenAspect; // é¨¾ï½¶ï½ï½®é¨¾ï½§„ãç¸º„çï½¹ï½§ï½ï½¹éƒ¢æ™ï½£ï½¹ç¸ºé†ï½¹æ™æ²ºï½ï½¯è­çµ¶†“é‚µï½ºèœ·ï½¶ï½ç‹—ï½¸ï½ºè²…å‡ï½½âˆ«ï½¸ï½ºï½ï½®é™‹æº·èª¿é‚ï½«

        var viewportRect = new Rect(0, 0, 1, 1); // Viewporté™‹ï½»è­„æï½„é™‹æ»‚ï½½ï½¤é‚µï½ºï½ï½§Rectéƒ¢ï½§èœ‘ƒïï½½ï½½è«›ˆˆ

        if (magRate < 1)
        {
            viewportRect.width = magRate; // é—–ï½´ï½ï½¿é¨¾åŒ…ï½½ï½¨é‚µï½ºèœ·ï½¶ï½ç–ï½®é›£ï½½ï½ªé™ï½·…ãï½å®šæ£”é€•ï½»èŸ²ï½©
            viewportRect.x = 0.5f - viewportRect.width * 0.5f;// é—•ï½³ï½ï½­é™æ»‚ï½½ï½®é™â„¡è¹é›·
        }
        else
        {
            viewportRect.height = 1 / magRate; // é—–ï½´ï½ï½¿é¨¾åŒ…ï½½ï½¨é‚µï½ºèœ·ï½¶ï½çŸ©ã—ï½ï½¦é™ï½·…ãï½å®šæ£”é€•ï½»èŸ²ï½©
            viewportRect.y = 0.5f - viewportRect.height * 0.5f;// é—•ï½³ï½ï½­é™æ»‚ï½½ï½®é™â„¡è¹é›·
        }

        targetCamera.rect = viewportRect; // éƒ¢ï½§ï½ï½«éƒ¢æ™¢ï½½ï½¡éƒ¢æ™¢ï½½ï½©é‚µï½ºï½ï½®Viewporté‚µï½ºï½ï½«é¬©åŒ…ï½½ï½©é¨¾åŒ…ï½½ï½¨
    }
}